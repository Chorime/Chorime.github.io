<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Kanji</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #f0f0f0; /* same as stats background */
    }
    body {
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: #f0f0f0;
      overflow: auto; 
      max-width: 100%;
    }
    
    .hidden { display: none; }

    /* Menu */
    #menu {
      text-align: center;
    }

    #menu h1 {
      margin-bottom: 20px;
    }

    .menu-button {
      display: block;
      margin: 10px auto;
      padding: 12px 20px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #1976d2;
      color: white;
      cursor: pointer;
      width: 250px;
      max-width: 100%;
    }

    /* Flashcard */
    #flashcard-screen {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .card-container {
      perspective: 1000px;
      width: 300px;
      height: 200px;
      margin-bottom: 20px;
      cursor: pointer;
      max-width: 100%;
    }

    .card {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .side {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      padding: 10px;
      text-align: center;
    }

    .back {
      transform: rotateY(180deg);
      background: white;
      font-size: 24px;
    }

    .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding-top: 10px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .right {
      background: #4caf50;
      color: white;
    }

    .wrong {
      background: #f44336;
      color: white;
    }

    .back-menu {
      margin-top: 20px;
      background: #888;
      color: white;
    }

    .stats-section {
      margin-bottom: 30px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    .stats-section canvas {
      width: 100% !important;   
      height: auto !important; 
      display: block;
    }

    .stats{
      overflow-x: hidden !important;
      box-sizing: border-box;
    }

    .hidden { 
      display: none !important; 
    }

    .stats-section h2 {
      margin-top: 0;
      color: #1976d2;
      font-size: 1.4rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    /* Review options screen */
.input-group {
  margin: 20px 0;
  text-align: left;
  width: 100%;
  max-width: 100%;
  margin-left: auto;
  margin-right: auto;
}

.input-group label {
  display: block;
  margin-bottom: 10px;
  font-weight: 500;
  color: #333;
}

/* Custom select styling */
.select-wrapper {
  position: relative;
  width: 100%;
  margin-bottom: 20px;
}

.threshold-select {
  width: 100%;
  padding: 16px 50px 16px 16px;
  font-size: 16px; /* Prevents zoom on iOS */
  border: 2px solid #ddd;
  border-radius: 12px;
  background-color: white;
  appearance: none; /* Remove default arrow */
  -webkit-appearance: none; /* Remove default arrow for Safari */
  -moz-appearance: none; /* Remove default arrow for Firefox */
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: border-color 0.3s, box-shadow 0.3s;
}

.threshold-select:focus {
  outline: none;
  border-color: #1976d2;
  box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);
}

.select-arrow {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: #666;
  font-size: 14px;
}

/* Button group styling */
.button-group {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
  max-width: 100%;
  margin: 0 auto;
}

/* Mobile-specific styles */
@media (max-width: 768px) {
  .input-group {
    margin: 15px 0;
  }
  
  .input-group label {
    font-size: 16px;
    margin-bottom: 8px;
  }
  
  .threshold-select {
    padding: 14px 45px 14px 14px;
    font-size: 16px; /* Maintain 16px to prevent zoom */
  }
  
  .select-arrow {
    right: 14px;
  }
  
  #review-options h2 {
    font-size: 1.4rem;
    margin-bottom: 20px;
  }
}

@media (max-width: 480px) {
  .input-group {
    margin: 12px 0;
  }
  
  .threshold-select {
    padding: 12px 40px 12px 12px;
    border-radius: 10px;
  }
  
  .select-arrow {
    right: 12px;
  }
  
  .button-group {
    max-width: 100%;
  }
}

/* Focus states for accessibility */
.threshold-select:focus {
  border-color: #1976d2;
  box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);
}

/* Hover effect for non-touch devices */
@media (hover: hover) {
  .threshold-select:hover {
    border-color: #999;
  }
}

    .statsTitles{
      text-align: center;
      font-size: 1.7rem;
    }

    .stat-card {
      background: #f5f7fa;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #1976d2;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #666;
    }

    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
      overflow: visible;
      margin: 15px 0;
      box-sizing: border-box;
    }
    
    .chart-container canvas {
      pointer-events: none; /* This prevents the canvas from capturing scroll events */
    }
    
    #categoryChart-container {
      margin-top: 10px; /* Add some space at the top */
    }

    #stats.screen-container {
      display: block;
      overflow-y: auto;
      overflow-x: hidden;
      margin: 0 auto;
      max-height: 90vh;
      width:100%;
      max-width: 100%;
      padding: 20px 15px;
      -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }
    @media (max-width: 768px) {
      #stats.screen-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;        /* full width */
        min-height: 100dvh;       /* full height */
        max-width: none;     /* remove panel constraint */
        margin: 0;           /* no centering */
        border-radius: 0;    /* flush with edges */
        background: #f0f0f0;    /* solid background */
        z-index: 999;        /* sit on top of everything */
        overflow-y: auto;    /* scroll if content too tall */
        padding: 10px;       /* smaller padding for mobile */
        box-sizing: border-box;
      } 
      .chart-container {
        height: 220px;
        margin: 10px 0;
      }
    
      #categoryChart-container {
        height: 300px;
      }
      .stats-section {
        padding: 15px;
        margin-bottom: 20px;
      }
      
      .stats-section h2 {
        font-size: 1.2rem;
        margin-bottom: 15px;
      }
    } 

    @media (max-width: 480px) {
      .chart-container {
        height: 200px;
      }
    
      #categoryChart-container {
      height: 270px;
    } 
    .stats-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .stat-card {
    padding: 12px;
    min-height: 70px;
  }
  
  .stat-number {
    font-size: 1.5rem;
  }
    }

    #subcategoryChart {
      height: 300px;
    }

    .overall-stats-container {
  width: 100%;
  max-width: 100%; /* Limit width to prevent overflow */
  margin: 0 auto; /* Center the container */
  box-sizing: border-box;
}

/* Ensure the stats screen has proper spacing */

#stats.screen-container h1 {
  margin-top: 0;
  padding-top: 10px;
  position: sticky;
  top: 0;
  background: white;
  z-index: 10;
}
  </style>
</head>
<body>

  <!-- Menu -->
<div id="menu">
  <h1>Kanji</h1>
  <button class="menu-button" onclick="showScreen('tandas')">Tandas</button>
  <button class="menu-button" onclick="showScreen('examenes')">Examen</button>
  <button class="menu-button" onclick="showScreen('subcategorias')">Subcategorias</button>
  <button class="menu-button" onclick="showScreen('review-options')">Repasar Errores</button>
  <button class="menu-button" onclick="showScreen('stats')">Estadisticas</button>
</div>

<div id="tandas" class="hidden" style="text-align:center;">
  <h1>Tandas</h1>
  <button class="menu-button" onclick="StartTanda('1ertanda')">Primera Tanda</button>
  <button class="menu-button" onclick="StartTanda('2datanda')">Segunda Tanda</button>
  <button class="menu-button" onclick="StartTanda('3ertanda')">Tercera Tanda</button>
  <button class="menu-button" onclick="StartTanda('4tatanda')">Cuarta Tanda</button>
  <button class="menu-button" onclick="StartTanda('5tatanda')">Quinta Tanda</button>
  <button class="menu-button" onclick="StartTanda('6tatanda')">Sexta Tanda</button>
  <button class="back-menu" onclick="goBackToMenu()">⬅ Volver al Menu</button>
</div>

<div id="examenes" class="hidden" style="text-align:center;">
  <h1>Examenes</h1>
  <button class="menu-button" onclick="StartExamen('N5')">N5</button>
  <button class="menu-button" onclick="StartExamen('N4')">N4</button>
  <button class="menu-button" onclick="StartExamen('N3')">N3</button>
  <button class="menu-button" onclick="StartExamen('N2')">N2</button>
  <button class="back-menu" onclick="goBackToMenu()">⬅ Volver al Menu</button>
</div>

<div id="subcategorias" class="hidden" style="text-align:center;">
    <h1>Subcategorias</h1>
    <div id="subcategoria-container" class="subcategoria-grid">
      <!-- Dynamic content will be inserted here -->
    </div>
    <button class="back-menu" onclick="goBackToMenu()">⬅ Volver al Menu</button>
  </div>

<!-- Review Options -->
<!-- Review Options -->
<div id="review-options" class="hidden screen-container">
  <h2 style="text-align: center;">Repasar Errores</h2>
  
  <div class="input-group">
    <label for="wrongThreshold">Minimo de errores en los ultimos 10 intentos:</label>
    <div class="select-wrapper">
      <select id="wrongThreshold" class="threshold-select">
        <option value="1">1+ errores</option>
        <option value="2">2+ errores</option>
        <option value="3">3+ errores</option>
        <option value="4">4+ errores</option>
        <option value="5">5+ errores</option>
      </select>
      <div class="select-arrow">▼</div>
    </div>
  </div>

  <div class="button-group">
    <button class="menu-button" onclick="startReviewWrong()">Empezar Repaso</button>
    <button class="back-menu" onclick="goBackToMenu()">⬅ Volver al Menu</button>
  </div>
</div>

  <!-- Flashcard Screen -->
  <div id="flashcard-screen" class="hidden">
    <div id="progress-bar" style="margin-bottom:10px; font-size:20px;">1/X</div>
    <div id="history-bar" style="margin-bottom:10px; font-size:20px;"></div> <!-- ✅ History here -->
    <div class="card-container">
      <div class="card" id="flashcard">
        <div class="side front" id="front"></div>
        <div class="side back" id="back"></div>
      </div>
    </div>

    <div class="buttons">
      <button class="right" onclick="markAnswer(true)">Bien</button>
      <button class="wrong" onclick="markAnswer(false)">Mal</button>
    </div>

    <button class="back-menu" onclick="goBackToMenu()">⬅ Volver al Menu</button>
  </div>
  
  <!-- End of Deck Screen -->
<div id="end-screen" class="hidden" style="text-align:center;">
  <h2 id="end-message">Terminaste esta tanda!</h2>
  <h2 id="percentage-right"></h2>
  <button class="menu-button" onclick="goBackToMenu()">⬅ Volver al Menu</button>
</div>

<!-- Stats screen -->
<div id="stats" class="screen-container hidden">
  <div class="stats-section">
  <div class="statsTitles" style="padding:20px; "><b>Overall Performance</b></div>
  <div class="overall-stats-container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="total-cards">0</div>
        <div class="stat-label">Cartas</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="mastered-cards">0</div>
        <div class="stat-label">Perfectas</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="success-rate">0%</div>
        <div class="stat-label">Porcentaje de Correctas</div>
      </div>
    </div>
  </div>
</div>

  <div class="stats-section">
    <div class="statsTitles">Performance por Categoria</div>
    <div class="chart-container">
      <canvas id="categoryChart" width="400" height="250"></canvas>
    </div>
  </div>

  <div class="stats-section">
    <div class="statsTitles">Performance por Subcategoria</div>
    <div class="chart-container">
      <canvas id="subcategoryChart" width="400" height="300"></canvas>
    </div>
  </div>

  <div class="stats-section">
    <div class="statsTitles">Performance Reciente</div>
    <div class="chart-container">
      <canvas id="trendChart" width="400" height="250"></canvas>
    </div>
  </div>
  <div style="text-align: center;"> 
    <button class="back-menu" style="text-align: center;" onclick="goBackToMenu()">⬅ Volver al Menu</button>
  </div>
  
</div>


  <script>
    console.log("Chart.js available:", typeof Chart !== "undefined");
  // Card sets
  const allCards = [
          // {word:"", meaning: "",categoria: "",examen: "", subcategoria: ""},

      {word:"晴れ", meaning: "はれ - Despejado",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"今日", meaning: "きょう - Hoy",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"海", meaning: "うみ - Mar",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"木", meaning: "き - Arbol",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"飲む", meaning: "のむ - Tomar",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"火", meaning: "ひ - Fuego",categoria: "1ertanda",examen: "N4", subcategoria: "Sustantivos"},
      {word:"聞く", meaning: "きく - Escuchar",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"東", meaning: "ひがし - Este",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"土", meaning: "つち - Tierra",categoria: "1ertanda",examen: "N3", subcategoria: "Sustantivos"},
      {word:"半", meaning: "はん - Mitad/Media",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"見る", meaning: "みる - Ver",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"小さい", meaning: "ちいさい - Pequeño",categoria: "1ertanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"千", meaning: "せん - 1000(Mil)",categoria: "1ertanda",examen: "N5", subcategoria: "Numeros"},
      {word:"大きい", meaning: "おおきい - Grande",categoria: "1ertanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"百", meaning: "ひゃく - 100(Cien)",categoria: "1ertanda",examen: "N5", subcategoria: "Numeros"},
      {word:"会う", meaning: "あう - Encontrarse",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"魚", meaning: "さかな - Pescado",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"国", meaning: "くに - Pais",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"父", meaning: "ちち - Padre",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"買う", meaning: "かう - Comprar",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"日", meaning: "ひ - Dia",categoria: "1ertanda",examen: "N4", subcategoria: "Sustantivos"},
      {word:"食べる", meaning: "たべる - Comer",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"言う", meaning: "いう - Decir",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"空", meaning: "そら - Cielo",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"山", meaning: "やま - Montaña",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"風", meaning: "かぜ - Viento",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"秋", meaning: "あき - Otoño",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"私", meaning: "わたし - Yo",categoria: "1ertanda",examen: "N5", subcategoria: "Extra"},
      {word:"南", meaning: "みなみ - Sur",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"今", meaning: "いま - Ahora",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"話す", meaning: "はなす - Hablar",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"読む", meaning: "よむ - Leer",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"卵", meaning: "たまご - Huevos",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"冬", meaning: "ふゆ - Invierno",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"人", meaning: "ひと - Persona",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"雨", meaning: "あめ - Lluvia",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"時", meaning: "じ - Hora",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"本", meaning: "ほん - Libro",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"水", meaning: "みず - Agua",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"雪", meaning: "ゆき - Nieve",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"肉", meaning: "にく - Carne",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"金", meaning: "かね - Dinero",categoria: "1ertanda",examen: "N3", subcategoria: "Sustantivos"},
      {word:"何", meaning: "なに - Que",categoria: "1ertanda",examen: "N5", subcategoria: "Extra"},
      {word:"円", meaning: "えん - Yenes",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"夏", meaning: "なつ - Verano",categoria: "1ertanda",examen: "N5", subcategoria: "Clima"},
      {word:"読書", meaning: "どくしょ - Lectura",categoria: "1ertanda",examen: "N3", subcategoria: "Sustantivos"},
      {word:"子ども", meaning: "こども - Niño",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"休む", meaning: "やすむ - Desansar",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"好き", meaning: "すき - Gustar",categoria: "1ertanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"川", meaning: "かわ - Rio",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"外国", meaning: "がいこく - Pais Extranjero",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"来る", meaning: "くる - Venir",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"花", meaning: "はな - Flor",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"北", meaning: "きた - Norte",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"月", meaning: "つき - Luna",categoria: "1ertanda",examen: "N3", subcategoria: "Sustantivos"},
      {word:"西", meaning: "にし - Oeste",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"口", meaning: "くち - Boca",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"春", meaning: "はる - Primavera",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"女", meaning: "おんな - Mujer",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"天気", meaning: "てんき - Clima",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"分", meaning: "ふん - Minuto",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"書く", meaning: "かく - Escribir",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"万", meaning: "まん - 10.000 (Diezmil)",categoria: "1ertanda",examen: "N5", subcategoria: "Numeros"},
      {word:"古い", meaning: "ふるい - Viejo",categoria: "1ertanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"男", meaning: "おとこ - Hombre",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"行く", meaning: "いく - Ir",categoria: "1ertanda",examen: "N5", subcategoria: "Verbos"},
      {word:"母", meaning: "はは - Madre",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"昼", meaning: "ひる - Mediodia",categoria: "1ertanda",examen: "N5", subcategoria: "Sustantivos"},
      

      {word: "町", meaning: "まち - Ciudad", categoria: "2datanda" ,examen: "N5", subcategoria: "Ciudad" },
      {word: "少", meaning: "すくない - Poco" ,categoria: "2datanda" , examen: "N5", subcategoria: "Adjetivos"},
      {word: "青い", meaning: "あおい - Azul" ,categoria: "2datanda" , examen: "N5", subcategoria: "Colores"},
      {word:"仕事", meaning: "しごと - Trabajo ",categoria: "2datanda",examen: "N5", subcategoria: "Profesiones"},
      {word:"広い", meaning: "ひろい - Amplio",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"乗る", meaning: "のる - Subirse",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"時間", meaning: "じかん - Hora/Tiempo",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"夜", meaning: "よる - Noche",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"赤い", meaning: "あかい - Rojo",categoria: "2datanda",examen: "N5", subcategoria: "Colores"},
      {word:"店", meaning: "みせ - Tienda",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"朝", meaning: " あさ - La mañana",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"道", meaning: "みち - Camino",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"高い", meaning: "たかい - Alto/Caro",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"待つ", meaning: "まつ - Esperar",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"右", meaning: "みぎ - Derecha",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"左", meaning: "ひだり",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"黒い", meaning: "くろい - Negro",categoria: "2datanda",examen: "N5", subcategoria: "Colores"},
      {word:"前", meaning: "まえ - Antes/Adelante",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"止まる", meaning: "とまる - Detenerse",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"人気", meaning: "にんき - Popular",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"出かける", meaning: "でかける - Salir",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"年", meaning: "ねん - Año",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"後", meaning: "あと - Despues",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"駅", meaning: "えき - Estacion",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"多い", meaning: "おおい - Mucho",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"食事", meaning: "しょくじ - Comida",categoria: "2datanda",examen: "N3", subcategoria: "Sustantivos"},
      {word:"安い", meaning: "やすい - Barato",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"白い", meaning: "しろい - Blanco",categoria: "2datanda",examen: "N5", subcategoria: "Colores"},
      {word:"場所", meaning: "ばしょ - Lugar",categoria: "2datanda",examen: "N4", subcategoria: "Sustantivos"},
      {word:"通り", meaning: "とおり - Calle",categoria: "2datanda",examen: "N3", subcategoria: "Sustantivos"},
    
    
      {word: "一年生", meaning: "いちねんせい - Estudiante de Primer Año", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "空港", meaning: "くうこう - Aeropuerto", categoria: "3ertanda", examen: "N4", subcategoria: "Sustantivos"},
      {word: "大学", meaning: "だいがく - Universidad", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "友だち", meaning: "ともだち - Amigo", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "中", meaning: "なか - Adentro", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "楽しい", meaning: "たのしい - Divertido", categoria: "3ertanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "本社", meaning: "ほんしゃ - Sede Principal de Empresa", categoria: "3ertanda", examen: "N3", subcategoria: "Sustantivos"},
      {word: "高校", meaning: "こうこう - Secundaria", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "出発", meaning: "しゅっぱつ - Partida", categoria: "3ertanda", examen: "N4", subcategoria: "Sustantivos"},
      {word: "小学校", meaning: "しょうがっこう - Escuela Primaria Baja", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "旅行", meaning: "りょこう - Viaje", categoria: "3ertanda", examen: "N4", subcategoria: "Sustantivos"},
      {word: "学生", meaning: "がくせい - Estudiante", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "午前", meaning: "ごぜん - A.M.", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "先生", meaning: "せんせい - Profesor", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "入る", meaning: "はいる - Tener Adentro", categoria: "3ertanda", examen: "N5", subcategoria: "Verbos"},
      {word: "お願い", meaning: "おねがい - Favor", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "食べ物", meaning: "たべもの - Comida", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "飲み物", meaning: "のみもの - Bebida", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "持つ", meaning: "もつ - Llevar", categoria: "3ertanda", examen: "N5", subcategoria: "Verbos"},
      {word: "色", meaning: "いろ - Color", categoria: "3ertanda", examen: "N5", subcategoria: "Colores"},
      {word: "料理", meaning: "りょうり - Comida", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "野菜", meaning: "やさい - Verdura", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "酒", meaning: "さけ - Alcohol", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "二回", meaning: "にかい - Dos Veces", categoria: "3ertanda", examen: "N4", subcategoria: "Extra"},
      {word: "午後", meaning: "ごご - P.M.", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "勉強", meaning: "べんきょう - Estudiar", categoria: "3ertanda", examen: "N5", subcategoria: "Verbos"},
      {word: "支社", meaning: "ししゃ - Sucursal De Empresa", categoria: "3ertanda", examen: "N3", subcategoria: "Sustantivos"},
      {word: "中学校", meaning: "ちゅうがっこう - Escuela Primaria Media", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "文化", meaning: "ぶんか - Cultura", categoria: "3ertanda", examen: "N3", subcategoria: "Sustantivos"},
      {word: "音楽", meaning: "おんがく - Música", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "学校", meaning: "がっこう - Escuela", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "会社", meaning: "かいしゃ - Empresa", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "味", meaning: "あじ - Sabor", categoria: "3ertanda", examen: "N4", subcategoria: "Sustantivos"},
      {word: "留学", meaning: "りゅうがく - Estudio en el Extranjero", categoria: "3ertanda", examen: "N3", subcategoria: "Sustantivos"},
      {word: "作る", meaning: "つくる - Preparar", categoria: "3ertanda", examen: "N3", subcategoria: "Verbos"},
      {word: "週", meaning: "しゅう - Semana", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "お茶", meaning: "おちゃ - Té", categoria: "3ertanda", examen: "N5", subcategoria: "Sustantivos"},
      {word: "出張", meaning: "しゅっちょう - Viaje de Negocios", categoria: "3ertanda", examen: "N3", subcategoria: "Sustantivos"},
      {word: "到着", meaning: "とうちゃく - Llegada", categoria: "3ertanda", examen: "N3", subcategoria: "Sustantivos"},

      {word: "時計", meaning: "とけい - Reloj", categoria: "4tatanda", examen: "N5", subcategoria: "Objetos"},
      {word: "結婚", meaning: "けっこん - Casamiento", categoria: "4tatanda", examen: "N4", subcategoria: "Eventos"},
      {word: "歩く", meaning: "あるく - Caminar", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "誕生日", meaning: "たんじょうび - Cumpleaños", categoria: "4tatanda", examen: "N5", subcategoria: "Eventos"},
      {word: "写真", meaning: "しゃしん - Foto", categoria: "4tatanda", examen: "N5", subcategoria: "Objetos"},
      {word: "送る", meaning: "おくる - Enviar", categoria: "4tatanda", examen: "N4", subcategoria: "Verbos"},
      {word: "体", meaning: "からだ - Cuerpo", categoria: "4tatanda", examen: "N5", subcategoria: "Partes del cuerpo"},
      {word: "週末", meaning: "しゅうまつ - Fin de semana", categoria: "4tatanda", examen: "N4", subcategoria: "Tiempo"},
      {word: "今年", meaning: "ことし - Este año", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "目", meaning: "め - Ojos", categoria: "4tatanda", examen: "N5", subcategoria: "Partes del cuerpo"},
      {word: "借りる", meaning: "かりる - Tomar prestado", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "去年", meaning: "きょねん - Año pasado", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "手", meaning: "て - Mano", categoria: "4tatanda", examen: "N5", subcategoria: "Partes del cuerpo"},
      {word: "思う", meaning: "おもう - Pensar", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "来週", meaning: "らいしゅう - Semana que viene", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "今週", meaning: "こんしゅう - Esta semana", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "足", meaning: "あし - Pies", categoria: "4tatanda", examen: "N5", subcategoria: "Partes del cuerpo"},
      {word: "起きる", meaning: "おきる - Levantarse", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "絵", meaning: "え - Pintura", categoria: "4tatanda", examen: "N5", subcategoria: "Objetos"},
      {word: "耳", meaning: "みみ - Oreja", categoria: "4tatanda", examen: "N5", subcategoria: "Partes del cuerpo"},
      {word: "家", meaning: "いえ - Casa", categoria: "4tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "毎日", meaning: "まいにち - Todos los días", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "使う", meaning: "つかう - Usar", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "毎朝", meaning: "まいあさ - Todas las mañanas", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "着る", meaning: "きる - Ponerse ropa (cintura para arriba)", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "毎月", meaning: "まいつき - Todos los meses", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "お祝い", meaning: "おいわい - Celebración", categoria: "4tatanda", examen: "N4", subcategoria: "Eventos"},
      {word: "来月", meaning: "らいげつ - Mes que viene", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "泳ぐ", meaning: "およぐ - Nadar", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "毎年", meaning: "まいとし - Todos los años", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "走る", meaning: "はしる - Correr", categoria: "4tatanda", examen: "N5", subcategoria: "Verbos"},
      {word: "電車", meaning: "でんしゃ - Tren", categoria: "4tatanda", examen: "N5", subcategoria: "Transporte"},
      {word: "元気", meaning: "げんき - Saludable", categoria: "4tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "下", meaning: "した - Abajo", categoria: "4tatanda", examen: "N5", subcategoria: "Posiciones"},
      {word: "上", meaning: "うえ - Arriba", categoria: "4tatanda", examen: "N5", subcategoria: "Posiciones"},
      {word: "今月", meaning: "こんげつ - Este mes", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "先月", meaning: "せんげつ - Mes pasado", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "電気", meaning: "でんき - Electricidad", categoria: "4tatanda", examen: "N5", subcategoria: "Objetos"},
      {word: "電話", meaning: "でんわ - Teléfono", categoria: "4tatanda", examen: "N5", subcategoria: "Objetos"},
      {word: "自分", meaning: "じぶん - Uno mismo", categoria: "4tatanda", examen: "N4", subcategoria: "Personas"},
      {word: "来年", meaning: "らいねん - Año que viene", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "先週", meaning: "せんしゅう - Semana pasada", categoria: "4tatanda", examen: "N5", subcategoria: "Tiempo"},
      {word: "車", meaning: "くるま - Auto", categoria: "4tatanda", examen: "N5", subcategoria: "Transporte"},
      {word: "頭", meaning: "あたま - Cabeza", categoria: "4tatanda", examen: "N5", subcategoria: "Partes del cuerpo"},

      {word: "自己紹介", meaning: "じこしょうかい - Presentación personal", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "名前", meaning: "なまえ - Nombre", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "意味", meaning: "いみ - Significado", categoria: "5tatanda", examen: "N5", subcategoria: "Conceptos abstractos"},
      {word: "～屋", meaning: "～や - Terminación tienda", categoria: "5tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "近い", meaning: "ちかい - Cercano", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "住む", meaning: "すむ - Residir", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "働く", meaning: "はたらく - Trabajar", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "～番目", meaning: "～ばんめ - Contador para cosas en una serie", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "兄", meaning: "あに - Hermano mayor", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "姉", meaning: "あね - Hermana mayor", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "弟", meaning: "おとうと - Hermano menor", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "妹", meaning: "いもうと - Hermana menor", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "家族", meaning: "かぞく - Familia", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "長い", meaning: "ながい - Largo", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "短い", meaning: "みじかい - Corto", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "歌", meaning: "うた - Canción", categoria: "5tatanda", examen: "N5", subcategoria: "Cultura"},
      {word: "低い", meaning: "ひくい - Bajo", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "上手", meaning: "じょうず - Habilidoso", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "お客さん", meaning: "おきゃくさん - Cliente", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "歌う", meaning: "うたう - Cantar", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "注文", meaning: "ちゅうもん - Pedido", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "洋食", meaning: "ようしょく - Comida occidental", categoria: "5tatanda", examen: "N4", subcategoria: "Comida"},
      {word: "和食", meaning: "わしょく - Comida japonesa", categoria: "5tatanda", examen: "N4", subcategoria: "Comida"},
      {word: "牛肉", meaning: "ぎゅうにく - Carne de vaca", categoria: "5tatanda", examen: "N5", subcategoria: "Comida"},
      {word: "地方", meaning: "ちほう - Región / Zona", categoria: "5tatanda", examen: "N4", subcategoria: "Lugares"},
      {word: "有名", meaning: "ゆうめい - Famoso", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "生", meaning: "なま - Crudo", categoria: "5tatanda", examen: "N4", subcategoria: "Comida"},
      {word: "冷たい", meaning: "つめたい - Frío (al tacto)", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "ご飯", meaning: "ごはん - Arroz / Comida", categoria: "5tatanda", examen: "N5", subcategoria: "Comida"},
      {word: "塩", meaning: "しお - Sal", categoria: "5tatanda", examen: "N5", subcategoria: "Comida"},
      {word: "全部", meaning: "ぜんぶ - Todo", categoria: "5tatanda", examen: "N5", subcategoria: "Conceptos abstractos"},
      {word: "食べ方", meaning: "たべかた - Manera de comer", categoria: "5tatanda", examen: "N4", subcategoria: "Comida"},
      {word: "熱い", meaning: "あつい - Caliente (objetos)", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "苦手", meaning: "にがて - Ser malo en", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "入れる", meaning: "いれる - Poner adentro", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "森", meaning: "もり - Bosque", categoria: "5tatanda", examen: "N5", subcategoria: "Naturaleza"},
      {word: "島", meaning: "しま - Isla", categoria: "5tatanda", examen: "N4", subcategoria: "Naturaleza"},
      {word: "自然", meaning: "しぜん - Naturaleza", categoria: "5tatanda", examen: "N4", subcategoria: "Naturaleza"},
      {word: "船", meaning: "ふね - Barco", categoria: "5tatanda", examen: "N5", subcategoria: "Objetos"},
      {word: "暑い", meaning: "あつい - Caluroso", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "帰る", meaning: "かえる - Regresar", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "予約", meaning: "よやく - Reservar", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "運転する", meaning: "うんてんする - Manejar", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "観光", meaning: "かんこう - Turismo", categoria: "5tatanda", examen: "N4", subcategoria: "Cultura"},
      {word: "観光地", meaning: "かんこうち - Atracción turística", categoria: "5tatanda", examen: "N4", subcategoria: "Lugares"},
      {word: "女性", meaning: "じょせい - Mujer", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "男性", meaning: "だんせい - Hombre", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "動物", meaning: "どうぶつ - Animales", categoria: "5tatanda", examen: "N5", subcategoria: "Naturaleza"},
      {word: "空気", meaning: "くうき - Aire", categoria: "5tatanda", examen: "N4", subcategoria: "Naturaleza"},
      {word: "料金", meaning: "りょうきん - Cargo", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "無料", meaning: "むりょう - Gratuito", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "明るい", meaning: "あかるい - Luminoso", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "便利", meaning: "べんり - Útil", categoria: "5tatanda", examen: "N4", subcategoria: "Adjetivos"},
      {word: "一年中", meaning: "いちねんじゅう - Durante todo el año", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "受付", meaning: "うけつけ - Recepción", categoria: "5tatanda", examen: "N4", subcategoria: "Lugares"},
      {word: "広場", meaning: "ひろば - Plaza", categoria: "5tatanda", examen: "N4", subcategoria: "Lugares"},
      {word: "問題", meaning: "もんだい - Problema", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "同じ", meaning: "おなじ - Igual", categoria: "5tatanda", examen: "N5", subcategoria: "Conceptos abstractos"},
      {word: "集まる", meaning: "あつまる - Juntarse (intransitivo)", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "始まる", meaning: "はじまる - Empezar", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "終わる", meaning: "おわる - Terminarse (intransitivo)", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "中止", meaning: "ちゅうし - Cancelar", categoria: "5tatanda", examen: "N3", subcategoria: "Verbos y acciones"},
      {word: "教える", meaning: "おしえる - Enseñar", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "祭り", meaning: "まつり - Festival", categoria: "5tatanda", examen: "N5", subcategoria: "Eventos y festividades"},
      {word: "会場", meaning: "かいじょう - Lugar del evento", categoria: "5tatanda", examen: "N3", subcategoria: "Lugares"},
      {word: "入場料", meaning: "にゅうじょうりょう - Precio de admisión", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "参加者", meaning: "さんかしゃ - Participante", categoria: "5tatanda", examen: "N3", subcategoria: "Personas y familia"},
      {word: "急ぐ", meaning: "いそぐ - Apurarse", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "決める", meaning: "きめる - Decidir", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "知る", meaning: "しる - Conocer / saber", categoria: "5tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "正月", meaning: "しょうがつ - Año nuevo", categoria: "5tatanda", examen: "N5", subcategoria: "Eventos y festividades"},
      {word: "年末", meaning: "ねんまつ - Fin de año", categoria: "5tatanda", examen: "N4", subcategoria: "Eventos y festividades"},
      {word: "年始", meaning: "ねんし - Principio de año", categoria: "5tatanda", examen: "N3", subcategoria: "Eventos y festividades"},
      {word: "親", meaning: "おや - Padres", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "忙しい", meaning: "いそがしい - Ocupado", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "特別", meaning: "とくべつ - Especial / Particular", categoria: "5tatanda", examen: "N4", subcategoria: "Adjetivos"},
      {word: "帰国", meaning: "きこく - Regresar al país", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "喜ぶ", meaning: "よろこぶ - Ponerse contento", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "幸せ", meaning: "しあわせ - Felicidad", categoria: "5tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "成長", meaning: "せいちょう - Crecimiento", categoria: "5tatanda", examen: "N3", subcategoria: "Conceptos abstractos"},
      {word: "長生き", meaning: "ながいき - Larga vida", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "願い事", meaning: "ねがいごと - Deseo/Pedido", categoria: "5tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "合格", meaning: "ごうかく - Aprobar", categoria: "5tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "試験", meaning: "しけん - Examen", categoria: "5tatanda", examen: "N5", subcategoria: "Conceptos abstractos"},
      {word: "大人", meaning: "おとな - Adulto", categoria: "5tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "成人式", meaning: "せいじんしき - Ceremonia de paso a la adultez", categoria: "5tatanda", examen: "N3", subcategoria: "Eventos y festividades"},
      {word: "～市", meaning: "～し - Terminación de ciudad", categoria: "5tatanda", examen: "N4", subcategoria: "Lugares"},

      {word: "商品", meaning: "しょうひん - Artículo", categoria: "6tatanda", examen: "N4", subcategoria: "Objetos"},
      {word: "電化製品", meaning: "でんかせいひん - Electrodoméstico", categoria: "6tatanda", examen: "N3", subcategoria: "Objetos"},
      {word: "電子レンジ", meaning: "でんしレンジ - Microondas", categoria: "6tatanda", examen: "N4", subcategoria: "Objetos"},
      {word: "掃除機", meaning: "そうじき - Aspiradora", categoria: "6tatanda", examen: "N4", subcategoria: "Objetos"},
      {word: "店員", meaning: "てんいん - Empleado de tienda", categoria: "6tatanda", examen: "N5", subcategoria: "Personas y familia"},
      {word: "調子が悪い", meaning: "ちょうしがわるい - En malas condiciones", categoria: "6tatanda", examen: "N4", subcategoria: "Adjetivos"},
      {word: "動く", meaning: "うごく - Moverse", categoria: "6tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "考える", meaning: "かんがえる - Pensar", categoria: "6tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "音が出る", meaning: "おとがでる - Emitir sonido", categoria: "6tatanda", examen: "N4", subcategoria: "Verbos y acciones"},
      {word: "機能", meaning: "きのう - Funciones", categoria: "6tatanda", examen: "N3", subcategoria: "Conceptos abstractos"},
      {word: "省エネ", meaning: "しょうエネ - Ahorro de energía", categoria: "6tatanda", examen: "N3", subcategoria: "Conceptos abstractos"},
      {word: "日本製", meaning: "にほんせい - Hecho en Japón", categoria: "6tatanda", examen: "N3", subcategoria: "Cultura"},
      {word: "重い", meaning: "おもい - Pesado", categoria: "6tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "軽い", meaning: "かるい - Liviano", categoria: "6tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "静か", meaning: "しずか - Tranquilo", categoria: "6tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "早い", meaning: "はやい - Temprano", categoria: "6tatanda", examen: "N5", subcategoria: "Adjetivos"},
      {word: "こっちの方", meaning: "こっちのほう - El de este lado", categoria: "6tatanda", examen: "N5", subcategoria: "Conceptos abstractos"},
      {word: "洗う", meaning: "あらう - Lavar", categoria: "6tatanda", examen: "N5", subcategoria: "Verbos y acciones"},
      {word: "満足する", meaning: "まんぞくする - Satisfacer", categoria: "6tatanda", examen: "N3", subcategoria: "Conceptos abstractos"},
      {word: "京都", meaning: "きょうと - Kyoto", categoria: "6tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "東京", meaning: "とうきょう - Tokyo", categoria: "6tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "お寺", meaning: "おてら - Templo budista", categoria: "6tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "神社", meaning: "じんじゃ - Santuario sintoísta", categoria: "6tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "仏教", meaning: "ぶっきょう - Budismo", categoria: "6tatanda", examen: "N3", subcategoria: "Cultura"},
      {word: "歴史", meaning: "れきし - Historia", categoria: "6tatanda", examen: "N4", subcategoria: "Cultura"},
      {word: "世界", meaning: "せかい - Mundo", categoria: "6tatanda", examen: "N5", subcategoria: "Conceptos abstractos"},
      {word: "中心", meaning: "ちゅうしん - Centro / Corazón", categoria: "6tatanda", examen: "N4", subcategoria: "Lugares"},
      {word: "世紀", meaning: "せいき - Siglo", categoria: "6tatanda", examen: "N3", subcategoria: "Conceptos abstractos"},
      {word: "日本的", meaning: "にほんてき - De estilo japonés", categoria: "6tatanda", examen: "N3", subcategoria: "Cultura"},
      {word: "歴史的", meaning: "れきしてき - Histórico", categoria: "6tatanda", examen: "N3", subcategoria: "Adjetivos"},
      {word: "何回目", meaning: "なんかいめ - Qué número de vez", categoria: "6tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "二回目", meaning: "にかいめ - Segunda vez", categoria: "6tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "飲食", meaning: "いんしょく - Beber y comer", categoria: "6tatanda", examen: "N3", subcategoria: "Verbos y acciones"},
      {word: "禁止", meaning: "きんし - Prohibición", categoria: "6tatanda", examen: "N3", subcategoria: "Conceptos abstractos"},
      {word: "説明", meaning: "せつめい - Explicación", categoria: "6tatanda", examen: "N4", subcategoria: "Conceptos abstractos"},
      {word: "道具", meaning: "どうぐ - Herramienta", categoria: "6tatanda", examen: "N4", subcategoria: "Objetos"},
      {word: "博物館", meaning: "はくぶつかん - Museo", categoria: "6tatanda", examen: "N3", subcategoria: "Lugares"},
      {word: "必要", meaning: "ひつよう - Necesario", categoria: "6tatanda", examen: "N4", subcategoria: "Adjetivos"},
      {word: "一階", meaning: "いっかい - Primer piso", categoria: "6tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "二階", meaning: "にかい - Segundo piso", categoria: "6tatanda", examen: "N5", subcategoria: "Lugares"},
      {word: "～館", meaning: "～かん - Terminación de edificio", categoria: "6tatanda", examen: "N4", subcategoria: "Lugares"},
    
  ];

  let currentSet = [];
  // let cards = [];
  let currentIndex = 0;
  let currentCard = null;
  let reviewWrongMode = false;
  let rightAnswers = 0;
  let categoryChartInstance = null;
  let subcategoryChartInstance = null;
  let trendChartInstance = null;

  const flashcard = document.getElementById("flashcard");
  const front = document.getElementById("front");
  const back = document.getElementById("back");

  function startSet(setName) {
    currentSet = setName;
    cards = cardSets[setName];
    reviewWrongMode = false;
    shuffle(cards);
    currentIndex = 0;
    showScreen("flashcard-screen");
    loadCard();
  }

  function getUniqueSubcategorias() {
    const subcategorias = allCards.map(card => card.subcategoria);
    return [...new Set(subcategorias)].sort();
  }

  function generateSubcategoriaButtons() {
    const container = document.getElementById("subcategoria-container");
    container.innerHTML = ""; // Clear previous content
    
    const subcategorias = getUniqueSubcategorias();
    
    if (subcategorias.length === 0) {
      container.innerHTML = "<p>No subcategories found</p>";
      return;
    }
    
    subcategorias.forEach(subcategoria => {
      const button = document.createElement("button");
      button.className = "subcategoria-button";
      button.textContent = subcategoria.charAt(0).toUpperCase() + subcategoria.slice(1);
      button.onclick = () => StartSubcategoria(subcategoria);
      container.appendChild(button);
    });
  }


  function StartTanda(categoria){
    currentSet = allCards.filter(c => c.categoria === categoria);
    shuffle(currentSet);
    currentIndex = 0;
    reviewWrongMode = false;
    showScreen("flashcard-screen");
    loadCard();
  }
    function StartExamen(examen){
    currentSet = allCards.filter(c => c.examen === examen);
    shuffle(currentSet);
    currentIndex = 0;
    reviewWrongMode = false;
    showScreen("flashcard-screen");
    loadCard();
  }
  function StartSubcategoria(subcategoria) {
    currentSet = allCards.filter(c => c.subcategoria === subcategoria);
    shuffle(currentSet);
    currentIndex = 0;
    reviewWrongMode = false;
    showScreen("flashcard-screen");
    loadCard();
  }

  
function startReviewWrong() {
  const threshold = parseInt(document.getElementById("wrongThreshold").value, 10);
  reviewWrongMode = true;
  currentSet = filterWrongCards(threshold);

  if (currentSet.length === 0) {
    alert("Ninguna carta coincide con los parametros de busqueda!");
    return;
  }

  
  shuffle(currentSet);
  currentIndex = 0;

  showScreen("flashcard-screen");
  loadCard();
}

  function loadCard() {
    if (currentSet.length === 0) {
      front.textContent = "No cards!";
      back.textContent = "";
      document.getElementById("history-bar").textContent = "";
      return;
    }
    document.getElementById("progress-bar").textContent = (currentIndex+1) + "/" + currentSet.length;
    if (!flashcard.classList.contains('flipped')) {
    currentCard = currentSet[currentIndex];
    front.textContent = currentCard.word;
    back.textContent = currentCard.meaning;

    // show meaning + recent history
    const history = getHistory(currentCard.word);
    const recentHistory = history.slice(-5);
    const displayHistory = recentHistory.map(item => {
    if (typeof item === 'string') {
      return item === "R" ? "✅" : "❌";
    } else {
      return item.result === "R" ? "✅" : "❌";
    }
    });
    document.getElementById("history-bar").textContent =
    "History: " + displayHistory.join(" ");
    }
    else{
    flashcard.classList.remove("flipped");
    currentCard = currentSet[currentIndex];
    front.textContent = currentCard.word;
    // show meaning + recent history
    const history = getHistory(currentCard.word);
    const recentHistory = history.slice(-5);
      const displayHistory = recentHistory.map(item => {
    if (typeof item === 'string') {
      return item === "R" ? "✅" : "❌";
    } else {
      return item.result === "R" ? "✅" : "❌";
    }
    });
    document.getElementById("history-bar").textContent =
    "History: " + displayHistory.join(" ");
    setTimeout(function() {
    back.textContent = currentCard.meaning;
    }, 600); // 600 milliseconds = 0,6 seconds (lo que tarda en girar la carta)
    }
  }

  flashcard.addEventListener("click", () => {
    flashcard.classList.toggle("flipped");
  });

  function markAnswer(isRight) {
    const cardId = currentCard.word;
    let wrongWords = JSON.parse(localStorage.getItem("wrongWords")) || [];

    // Update wrongWords list
    if (isRight) {
      wrongWords = wrongWords.filter(c => c.word !== currentCard.word);
      rightAnswers++;
    } else {
      if (!wrongWords.find(c => c.word === currentCard.word)) {
        wrongWords.push(currentCard);
      }
    }
    localStorage.setItem("wrongWords", JSON.stringify(wrongWords));

    // Update history
    let history = getHistory(cardId);
    history.push({
    result: isRight ? "R" : "W",
    timestamp: new Date().toISOString()
    });
    if (history.length > 10) history.shift(); // keep last 10
    localStorage.setItem("history_" + cardId, JSON.stringify(history));

    currentIndex++;
    if (currentIndex >= currentSet.length) {
    document.getElementById("percentage-right").textContent = "Hiciste " + Math.trunc((rightAnswers/currentSet.length)*100) + "% bien";
    showScreen("end-screen");
    rightAnswers = 0;
    document.getElementById("end-message").textContent =
      reviewWrongMode ? "Terminaste de revisar las cartas en las que te confundiste!" : "Terminaste este Set!";
    } else {
    loadCard();
    }
  }

  function loadAllWrongCards() {
    return JSON.parse(localStorage.getItem("wrongWords")) || [];
  }
  
function filterWrongCards(threshold) {
  // const allCards = Object.values(cardSets).flat(); // flatten all sets
  return allCards.filter(card => {
    const history = getHistory(card.word);
        const wrongs = history.filter(item => {
      if (typeof item === 'string') {
        return item === 'W';
      } else if (typeof item === 'object' && item !== null) {
        return item.result === 'W';
      }
      return false;
    }).length;
    return wrongs >= threshold;
  });
}

  function getHistory(cardId) {
    const history =  JSON.parse(localStorage.getItem("history_" + cardId)) || [];
    if (history.length > 0 && typeof history[0] === 'string') {
    const newHistory = history.map(result => ({
      result: result,
      timestamp: new Date().toISOString() // Approximate timestamp
    }));
    localStorage.setItem("history_" + cardId, JSON.stringify(newHistory));
    return newHistory;
  }
  
  return history;
  }


  function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  }

  function goBackToMenu() {
    rightAnswers = 0;
    showScreen("menu");
  }

  function showScreen(id) {
    if (document.getElementById("stats") && !document.getElementById("stats").classList.contains("hidden")) {
    destroyAllCharts();
    }
    if (id === "subcategorias") {
      generateSubcategoriaButtons();
    }
    if (id === "stats") {
      resetCanvases();
      displayStats();
      setTimeout(enableStatsScrolling, 500);
      setTimeout(adjustChartLayout, 300);
    }
  ["menu","tandas","examenes","stats","subcategorias","flashcard-screen", "review-options", "end-screen"].forEach(s =>
    document.getElementById(s).classList.add("hidden")
  );
  document.getElementById(id).classList.remove("hidden");
  }
  
  function resetCanvases() {
  // Get all canvas elements
  const canvases = document.querySelectorAll('canvas');
  
  // Replace each canvas with a clone to reset it completely
  canvases.forEach(canvas => {
    const clone = canvas.cloneNode(true);
    canvas.parentNode.replaceChild(clone, canvas);
  });
}

function calculateRecentPerformance() {
  const recentTrend = [];
  const today = new Date();
  
  // Create empty entries for the last 7 days
  for (let i = 6; i >= 0; i--) {
    const date = new Date();
    date.setDate(today.getDate() - i);
    const dateString = date.toISOString().split('T')[0];
    
    recentTrend.push({
      date: dateString,
      correct: 0,
      total: 0
    });
  }
  
  // Collect all answer history across all cards
  let allAnswers = [];
  
  allCards.forEach(card => {
    const history = getHistory(card.word);
    history.forEach(entry => {
      if (entry.timestamp) {
        const answerDate = new Date(entry.timestamp).toISOString().split('T')[0];
        allAnswers.push({
          date: answerDate,
          result: typeof entry === 'string' ? entry : entry.result
        });
      }
    });
  });
  
  // Count answers for each day
  allAnswers.forEach(answer => {
    const trendEntry = recentTrend.find(entry => entry.date === answer.date);
    if (trendEntry) {
      trendEntry.total++;
      if (answer.result === 'R') {
        trendEntry.correct++;
      }
    }
  });
  
  return recentTrend;
}


// Function to calculate statistics
function calculateStats() {
  const stats = {
    byCategory: {},
    bySubcategory: {},
    overall: {
      total: allCards.length,
      mastered: 0,
      successRate: 0,
      totalAttempts: 0,
      correctAttempts: 0
    },
    recentTrend: calculateRecentPerformance()
  };

  // Calculate performance for each card
  allCards.forEach(card => {
    const history = getHistory(card.word);
    const totalAttempts = history.length;
    const correctAttempts = history.filter(item => {
      if (typeof item === 'string') {
        return item === 'R';
      } else {
        return item.result === 'R';
      }
    }).length;
    
    const successRate = totalAttempts > 0 ? (correctAttempts / totalAttempts) * 100 : 0;
    
    // Update overall stats
    stats.overall.totalAttempts += totalAttempts;
    stats.overall.correctAttempts += correctAttempts;
    
    // Update category stats
    if (!stats.byCategory[card.categoria]) {
      stats.byCategory[card.categoria] = { total: 0, attempts: 0, correct: 0, successRate: 0 };
    }
    stats.byCategory[card.categoria].total++;
    stats.byCategory[card.categoria].attempts += totalAttempts;
    stats.byCategory[card.categoria].correct += correctAttempts;
    
    // Update subcategory stats
    if (!stats.bySubcategory[card.subcategoria]) {
      stats.bySubcategory[card.subcategoria] = { total: 0, attempts: 0, correct: 0, successRate: 0 };
    }
    stats.bySubcategory[card.subcategoria].total++;
    stats.bySubcategory[card.subcategoria].attempts += totalAttempts;
    stats.bySubcategory[card.subcategoria].correct += correctAttempts;
    
    // Check if mastered (80% or higher success rate with at least 3 attempts)
    if (successRate >= 80 && totalAttempts >= 3) {
      stats.overall.mastered++;
    }
  });
  
  // Calculate overall success rate
  stats.overall.successRate = stats.overall.totalAttempts > 0 ? 
    (stats.overall.correctAttempts / stats.overall.totalAttempts) * 100 : 0;
  
  // Calculate category success rates
  for (const category in stats.byCategory) {
    stats.byCategory[category].successRate = 
      stats.byCategory[category].attempts > 0 ? 
      (stats.byCategory[category].correct / stats.byCategory[category].attempts) * 100 : 0;
  }
  
  // Calculate subcategory success rates
  for (const subcategory in stats.bySubcategory) {
    stats.bySubcategory[subcategory].successRate = 
      stats.bySubcategory[subcategory].attempts > 0 ? 
      (stats.bySubcategory[subcategory].correct / stats.bySubcategory[subcategory].attempts) * 100 : 0;
  }
  
  return stats;
}

// Add event listeners to handle scrolling on charts
// Alternative approach: Use a passive event listener
function enableStatsScrolling() {
  const statsScreen = document.getElementById('stats');
  if (!statsScreen || statsScreen.classList.contains('hidden')) return;
  
  const charts = statsScreen.querySelectorAll('.chart-container');
  
  charts.forEach(chart => {
    // Add a passive wheel event listener to prevent default behavior
    chart.addEventListener('wheel', function(e) {
      const statsScreen = document.getElementById('stats');
      if (statsScreen && statsScreen.scrollHeight > statsScreen.clientHeight) {
        // Let the event bubble up to the stats screen
        // We don't preventDefault here, we just let it bubble
      }
    }, { passive: true });
  });
  
  // Ensure the stats screen itself is scrollable
  statsScreen.addEventListener('wheel', function(e) {
    // This ensures the stats screen captures the scroll event
  }, { passive: true });
}


// Function to create trend chart
function createTrendChart(trendData) {
  const canvas = document.getElementById('trendChart');
  const ctx = canvas.getContext('2d');
  
  // Check if chart already exists using Chart.js method
  if (Chart.getChart(canvas)) {
    Chart.getChart(canvas).destroy();
  }
  
  // Format dates for display (show as MM/DD)
  const formattedDates = trendData.map(item => {
    const dateParts = item.date.split('-');
    return `${dateParts[1]}/${dateParts[2]}`;
  });
  
  // Calculate success rates
  const successRates = trendData.map(item => 
    item.total > 0 ? (item.correct / item.total) * 100 : 0
  );
  
  return new Chart(ctx, {
    type: 'line',
    data: {
      labels: formattedDates,
      datasets: [{
        label: 'Daily Success Rate (%)',
        data: successRates,
        fill: false,
        borderColor: 'rgba(156, 39, 176, 1)',
        backgroundColor: 'rgba(156, 39, 176, 0.2)',
        tension: 0.1,
        pointBackgroundColor: 'rgba(156, 39, 176, 1)',
        pointRadius: 4,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: {
            display: true,
            text: 'Success Rate (%)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Date'
          }
        }
      },
      plugins: {
        tooltip: {
          callbacks: {
            label: function(context) {
              const index = context.dataIndex;
              const correct = trendData[index].correct;
              const total = trendData[index].total;
              return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}% (${correct}/${total} correct)`;
            }
          }
        }
      }
    }
  });
}

// Function to display statistics
function displayStats() {
  try {
    // Check if Chart.js is loaded
    if (typeof Chart === "undefined") {
      alert("Chart.js library not loaded. Please check your internet connection.");
      return;
    }
    
    const stats = calculateStats();
    
    // Update overall stats
    document.getElementById('total-cards').textContent = stats.overall.total;
    document.getElementById('mastered-cards').textContent = stats.overall.mastered;
    document.getElementById('success-rate').textContent = `${stats.overall.successRate.toFixed(1)}%`;
    
    // Create category chart
    const categoryCtx = document.getElementById('categoryChart');
    if (categoryCtx) {
      createCategoryChart(stats.byCategory);
    } else {
      console.error("Category chart canvas not found");
    }
    
    // Create subcategory chart
    const subcategoryCtx = document.getElementById('subcategoryChart');
    if (subcategoryCtx) {
      createSubcategoryChart(stats.bySubcategory);
    } else {
      console.error("Subcategory chart canvas not found");
    }

    createTrendChart(stats.recentTrend);
    setTimeout(enableStatsScrolling, 100);
    
  } catch (error) {
    console.error("Error displaying stats:", error);
    alert("Error displaying statistics: " + error.message);
  }
}


// Function to create category chart
function createCategoryChart(categoryData) {
  const canvas = document.getElementById('categoryChart');
  const ctx = canvas.getContext('2d');
  
  // Check if chart already exists using Chart.js method
  if (Chart.getChart(canvas)) {
    Chart.getChart(canvas).destroy();
  }
  
  const categories = Object.keys(categoryData);
  const successRates = categories.map(cat => categoryData[cat].successRate);

  const isMobile = window.innerWidth <= 768;
  
  return new Chart(ctx, {
    type: 'bar',
    data: {
      labels: categories,
      datasets: [{
        label: 'Success Rate (%)',
        data: successRates,
        backgroundColor: 'rgba(25, 118, 210, 0.7)',
        borderColor: 'rgba(25, 118, 210, 1)',
        borderWidth: 1,
        barPercentage: isMobile ? 0.6 : 0.8, // Thinner bars on mobile
        categoryPercentage: 0.8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: {
        padding: {
          top: 20,    // Add padding at the top
          bottom: 10,
          left: 10,
          right: 10
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          grace: '5%', // Add grace space at the top
          title: {
            display: true,
            text: 'Success Rate (%)',
            padding: {top: 10, bottom: 10}
          },
          ticks: {
            precision: 0
          }
        },
        x: {
          ticks: {
            maxRotation: isMobile ? 90 : 45, // More rotation on mobile
            minRotation: isMobile ? 90 : 45,
            autoSkip: true,
            maxTicksLimit: isMobile ? 5 : 10, // Fewer labels on mobile
            font: {
              size: isMobile ? 10 : 12
            }
          }
        }
      },
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          enabled: !isMobile, // Disable tooltips on mobile (use tap instead)
          mode: 'index',
          intersect: false,
          callbacks: {
            label: function(context) {
              const category = context.label;
              const attempts = categoryData[category].attempts;
              const correct = categoryData[category].correct;
              return `Success: ${context.parsed.y.toFixed(1)}% (${correct}/${attempts} correct)`;
            }
          }
        }
      }
    }
  });
}

function adjustChartLayout() {
  // Wait for the DOM to update
  setTimeout(() => {
    const chartContainers = document.querySelectorAll('.chart-container');
    
    chartContainers.forEach(container => {
      const canvas = container.querySelector('canvas');
      if (canvas && canvas.chart) {
        canvas.chart.resize(); // Force chart to recalculate its layout
      }
    });
  }, 100);
}

function destroyAllCharts() {
  if (categoryChartInstance) {
    categoryChartInstance.destroy();
    categoryChartInstance = null;
  }
  
  if (subcategoryChartInstance) {
    subcategoryChartInstance.destroy();
    subcategoryChartInstance = null;
  }
  
  if (trendChartInstance) {
    trendChartInstance.destroy();
    trendChartInstance = null;
  }
}

// Function to create subcategory chart
function createSubcategoryChart(subcategoryData) {
  const ctx = document.getElementById('subcategoryChart').getContext('2d');
  
  const subcategories = Object.keys(subcategoryData);
  const successRates = subcategories.map(sub => subcategoryData[sub].successRate);
  
  const isMobile = window.innerWidth <= 768;

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: subcategories,
      datasets: [{
        label: 'Success Rate (%)',
        data: successRates,
        backgroundColor: 'rgba(76, 175, 80, 0.7)',
        borderColor: 'rgba(76, 175, 80, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      indexAxis: 'y',
      scales: {
        x: {
          beginAtZero: true,
          max: 100,
          title: {
            display: !isMobile,
            text: 'Success Rate (%)'
          }
        }
      }
    }
  });
}

// Function to create trend chart
function createTrendChart(trendData) {
  const ctx = document.getElementById('trendChart').getContext('2d');
  
  const dates = trendData.map(item => item.date);
  const successRates = trendData.map(item => 
    item.total > 0 ? (item.correct / item.total) * 100 : 0
  );
  
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        label: 'Daily Success Rate (%)',
        data: successRates,
        fill: false,
        borderColor: 'rgba(156, 39, 176, 1)',
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: {
            display: true,
            text: 'Success Rate (%)'
          }
        }
      }
    }
  });
}

</script>

</body>
</html>


