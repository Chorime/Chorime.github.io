<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcards</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: #f0f0f0;
    }

    .hidden { display: none; }

    /* Menu */
    #menu {
      text-align: center;
    }

    #menu h1 {
      margin-bottom: 20px;
    }

    .menu-button {
      display: block;
      margin: 10px auto;
      padding: 12px 20px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #1976d2;
      color: white;
      cursor: pointer;
      width: 250px;
    }

    /* Flashcard */
    #flashcard-screen {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .card-container {
      perspective: 1000px;
      width: 300px;
      height: 200px;
      margin-bottom: 20px;
      cursor: pointer;
    }

    .card {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .side {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      padding: 10px;
      text-align: center;
    }

    .back {
      transform: rotateY(180deg);
      background: white;
      font-size: 24px;
    }

    .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding-top: 10px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .right {
      background: #4caf50;
      color: white;
    }

    .wrong {
      background: #f44336;
      color: white;
    }

    .back-menu {
      margin-top: 20px;
      background: #888;
      color: white;
    }
  </style>
</head>
<body>

  <!-- Menu -->
<div id="menu">
  <h1>Flashcards</h1>
  <button class="menu-button" onclick="showScreen('tandas')">Tandas</button>
  <button class="menu-button" onclick="showScreen('examenes')">Examen</button>
  <button class="menu-button" onclick="showScreen('subcategorias')">Subcategoria</button>
  <button class="menu-button" onclick="showScreen('review-options')">Review Wrong Cards</button>
</div>

<div id="tandas" class="hidden" style="text-align:center;">
  <h1>Tandas</h1>
  <button class="menu-button" onclick="StartTanda('1ertanda')">Primera Tanda</button>
  <button class="menu-button" onclick="StartTanda('2datanda')">Segunda Tanda</button>
  <button class="menu-button" onclick="StartTanda('3ertanda')">Tercera Tanda</button>
  <button class="menu-button" onclick="StartTanda('4tatanda')">Cuarta Tanda</button>
  <button class="back-menu" onclick="goBackToMenu()">⬅ Back to Menu</button>
</div>

<div id="examenes" class="hidden" style="text-align:center;">
  <h1>Examenes</h1>
  <button class="menu-button" onclick="StartExamen('N5')">N5</button>
  <button class="menu-button" onclick="StartExamen('N4')">N4</button>
  <button class="menu-button" onclick="StartExamen('N3')">N3</button>
  <button class="menu-button" onclick="StartExamen('N2')">N2</button>
  <button class="back-menu" onclick="goBackToMenu()">⬅ Back to Menu</button>
</div>

<div id="subcategorias" class="hidden" style="text-align:center;">
    <h1>Subcategorias</h1>
    <div id="subcategoria-container" class="subcategoria-grid">
      <!-- Dynamic content will be inserted here -->
    </div>
    <button class="back-menu" onclick="goBackToMenu()">⬅ Back to Menu</button>
  </div>

<!-- Review Options -->
<div id="review-options" class="hidden" style="text-align:center;">
  <h2>Review Wrong Cards</h2>
  <label for="wrongThreshold">Minimum wrongs in last 5 attempts:</label>
  <select id="wrongThreshold">
    <option value="1">1+</option>
    <option value="2">2+</option>
    <option value="3">3+</option>
    <option value="4">4+</option>
    <option value="5">5 (always wrong)</option>
  </select>
  <br><br>
  <button class="menu-button" onclick="startReviewWrong()">Start Review</button>
  <button class="back-menu" onclick="goBackToMenu()">⬅ Back to Menu</button>
</div>

  <!-- Flashcard Screen -->
  <div id="flashcard-screen" class="hidden">
    <div id="progress-bar" style="margin-bottom:10px; font-size:20px;">1/X</div>
    <div id="history-bar" style="margin-bottom:10px; font-size:20px;"></div> <!-- ✅ History here -->
    <div class="card-container">
      <div class="card" id="flashcard">
        <div class="side front" id="front"></div>
        <div class="side back" id="back"></div>
      </div>
    </div>

    <div class="buttons">
      <button class="right" onclick="markAnswer(true)">Right</button>
      <button class="wrong" onclick="markAnswer(false)">Wrong</button>
    </div>

    <button class="back-menu" onclick="goBackToMenu()">⬅ Back to Menu</button>
  </div>
  
  <!-- End of Deck Screen -->
<div id="end-screen" class="hidden" style="text-align:center;">
  <h2 id="end-message">You finished this set!</h2>
  <h2 id="percentage-right"></h2>
  <button class="menu-button" onclick="goBackToMenu()">⬅ Back to Menu</button>
</div>


  <script>
  // Card sets
  const allCards = [
          // {word:"", meaning: "",categoria: "",examen: "", subcategoria: ""},

      {word: "inu", meaning: "dog" ,categoria: "1ertanda" , examen: "N5", subcategoria: "animales"},
      {word: "neko", meaning: "cat",categoria: "1ertanda" ,examen: "N5", subcategoria: "animales" },
      {word: "tori", meaning: "bird",categoria: "1ertanda" ,examen: "N5", subcategoria: "animales" },


      {word: "町", meaning: "まち - Ciudad", categoria: "2datanda" ,examen: "N5", subcategoria: "Ciudad" },
      {word: "少", meaning: "すくない - Poco" ,categoria: "2datanda" , examen: "N5", subcategoria: "Adjetivos"},
      {word: "青い", meaning: "あおい - Azul" ,categoria: "2datanda" , examen: "N5", subcategoria: "Colores"},
      {word:"仕事", meaning: "しごと - Trabajo ",categoria: "2datanda",examen: "N5", subcategoria: "Profesiones"},
      {word:"広い", meaning: "ひろい - Amplio",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"乗る", meaning: "のる - Subirse",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"時間", meaning: "じかん - Hora/Tiempo",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"夜", meaning: "よる - Noche",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"赤い", meaning: "あかい - Rojo",categoria: "2datanda",examen: "N5", subcategoria: "Colores"},
      {word:"店", meaning: "みせ - Tienda",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"朝", meaning: " あさ - La mañana",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"道", meaning: "みち - Camino",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"高い", meaning: "たかい - Alto/Caro",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"待つ", meaning: "まつ - Esperar",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"右", meaning: "みぎ - Derecha",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"左", meaning: "ひだり",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"黒い", meaning: "くろい - Negro",categoria: "2datanda",examen: "N5", subcategoria: "Colores"},
      {word:"前", meaning: "まえ - Antes/Adelante",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"止まる", meaning: "とまる - Detenerse",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"人気", meaning: "にんき - Popular",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"出かける", meaning: "でかける - Salir",categoria: "2datanda",examen: "N5", subcategoria: "Verbos"},
      {word:"年", meaning: "ねん - Año",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"後", meaning: "あと - Despues",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"駅", meaning: "えき - Estacion",categoria: "2datanda",examen: "N5", subcategoria: "Sustantivos"},
      {word:"多い", meaning: "おおい - Mucho",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"食事", meaning: "しょくじ - Comida",categoria: "2datanda",examen: "N3", subcategoria: "Sustantivos"},
      {word:"安い", meaning: "やすい - Barato",categoria: "2datanda",examen: "N5", subcategoria: "Adjetivos"},
      {word:"白い", meaning: "しろい - Blanco",categoria: "2datanda",examen: "N5", subcategoria: "Colores"},
      {word:"場所", meaning: "ばしょ - Lugar",categoria: "2datanda",examen: "N4", subcategoria: "Sustantivos"},
      {word:"通り", meaning: "とおり - Calle",categoria: "2datanda",examen: "N3", subcategoria: "Sustantivos"},
    
    
      {word: "taberu", meaning: "to eat",categoria: "3ertanda" ,examen: "N5", subcategoria: "prueba"},
      {word: "nomu", meaning: "to drink",categoria: "3ertanda" ,examen: "N5", subcategoria: "prueba"},
      {word: "miru", meaning: "to see",categoria: "3ertanda" ,examen: "N5", subcategoria: "prueba"}
    
  ];

  let currentSet = [];
  // let cards = [];
  let currentIndex = 0;
  let currentCard = null;
  let reviewWrongMode = false;
  let rightAnswers = 0;

  const flashcard = document.getElementById("flashcard");
  const front = document.getElementById("front");
  const back = document.getElementById("back");

  function startSet(setName) {
    currentSet = setName;
    cards = cardSets[setName];
    reviewWrongMode = false;
    shuffle(cards);
    currentIndex = 0;
    showScreen("flashcard-screen");
    loadCard();
  }

  function getUniqueSubcategorias() {
    const subcategorias = allCards.map(card => card.subcategoria);
    return [...new Set(subcategorias)].sort();
  }

  function generateSubcategoriaButtons() {
    const container = document.getElementById("subcategoria-container");
    container.innerHTML = ""; // Clear previous content
    
    const subcategorias = getUniqueSubcategorias();
    
    if (subcategorias.length === 0) {
      container.innerHTML = "<p>No subcategories found</p>";
      return;
    }
    
    subcategorias.forEach(subcategoria => {
      const button = document.createElement("button");
      button.className = "subcategoria-button";
      button.textContent = subcategoria.charAt(0).toUpperCase() + subcategoria.slice(1);
      button.onclick = () => StartSubcategoria(subcategoria);
      container.appendChild(button);
    });
  }


  function StartTanda(categoria){
    currentSet = allCards.filter(c => c.categoria === categoria);
    shuffle(currentSet);
    currentIndex = 0;
    reviewWrongMode = false;
    showScreen("flashcard-screen");
    loadCard();
  }
    function StartExamen(examen){
    currentSet = allCards.filter(c => c.examen === examen);
    shuffle(currentSet);
    currentIndex = 0;
    reviewWrongMode = false;
    showScreen("flashcard-screen");
    loadCard();
  }
  function StartSubcategoria(subcategoria) {
    currentSet = allCards.filter(c => c.subcategoria === subcategoria);
    shuffle(currentSet);
    currentIndex = 0;
    reviewWrongMode = false;
    showScreen("flashcard-screen");
    loadCard();
  }

  
function startReviewWrong() {
  const threshold = parseInt(document.getElementById("wrongThreshold").value, 10);
  reviewWrongMode = true;
  currentSet = filterWrongCards(threshold);

  if (currentSet.length === 0) {
    alert("No cards match this condition!");
    return;
  }

  
  shuffle(currentSet);
  currentIndex = 0;

  showScreen("flashcard-screen");
  loadCard();
}

  function loadCard() {
    if (currentSet.length === 0) {
      front.textContent = "No cards!";
      back.textContent = "";
      document.getElementById("history-bar").textContent = "";
      return;
    }
    document.getElementById("progress-bar").textContent = (currentIndex+1) + "/" + currentSet.length;
    if (!flashcard.classList.contains('flipped')) {
    currentCard = currentSet[currentIndex];
    front.textContent = currentCard.word;
    back.textContent = currentCard.meaning;

    // show meaning + recent history
    const history = getHistory(currentCard.word);
    document.getElementById("history-bar").textContent =
    "History: " + history.map(r => r === "R" ? "✅" : "❌").join(" ");
    }
    else{
    flashcard.classList.remove("flipped");
    currentCard = currentSet[currentIndex];
    front.textContent = currentCard.word;
    // show meaning + recent history
    const history = getHistory(currentCard.word);
    document.getElementById("history-bar").textContent =
    "History: " + history.map(r => r === "R" ? "✅" : "❌").join(" ");
    setTimeout(function() {
    back.textContent = currentCard.meaning;
    }, 600); // 600 milliseconds = 0,6 seconds (lo que tarda en girar la carta)
    }
  }

  flashcard.addEventListener("click", () => {
    flashcard.classList.toggle("flipped");
  });

  function markAnswer(isRight) {
    const cardId = currentCard.word;
    let wrongWords = JSON.parse(localStorage.getItem("wrongWords")) || [];

    // Update wrongWords list
    if (isRight) {
      wrongWords = wrongWords.filter(c => c.word !== currentCard.word);
      rightAnswers++;
    } else {
      if (!wrongWords.find(c => c.word === currentCard.word)) {
        wrongWords.push(currentCard);
      }
    }
    localStorage.setItem("wrongWords", JSON.stringify(wrongWords));

    // Update history
    let history = getHistory(cardId);
    history.push(isRight ? "R" : "W");
    if (history.length > 5) history.shift(); // keep last 5
    localStorage.setItem("history_" + cardId, JSON.stringify(history));

    currentIndex++;
    if (currentIndex >= currentSet.length) {
    document.getElementById("percentage-right").textContent = "You got " + Math.trunc((rightAnswers/currentSet.length)*100) + "% right";
    showScreen("end-screen");
    rightAnswers = 0;
    document.getElementById("end-message").textContent =
      reviewWrongMode ? "You finished reviewing your wrong cards!" : "You finished this set!";
    } else {
    loadCard();
    }
  }

  function loadAllWrongCards() {
    return JSON.parse(localStorage.getItem("wrongWords")) || [];
  }
  
function filterWrongCards(threshold) {
  // const allCards = Object.values(cardSets).flat(); // flatten all sets
  return allCards.filter(card => {
    const history = getHistory(card.word);
    const wrongs = history.filter(r => r === "W").length;
    return wrongs >= threshold;
  });
}

  function getHistory(cardId) {
    return JSON.parse(localStorage.getItem("history_" + cardId)) || [];
  }


  function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

  function goBackToMenu() {
    showScreen("menu");
  }

  function showScreen(id) {
    if (id === "subcategorias") {
      generateSubcategoriaButtons();
    }
  ["menu","tandas","examenes","subcategorias","flashcard-screen", "review-options", "end-screen"].forEach(s =>
    document.getElementById(s).classList.add("hidden")
  );
  document.getElementById(id).classList.remove("hidden");
}

</script>

</body>
</html>
